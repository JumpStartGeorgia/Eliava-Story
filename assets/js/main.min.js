var youtubePlayers={},loaderReady=!1;$(document).ready(function(){function t(e){(e||!m)&&(k.completed?(E.partial(),m=!1):(e||k.abort(),m=!0,setTimeout(function(){t(!0)},100)))}function e(){n=$(window).width(),i=$(window).height(),_.step=n/5,_.origin=n/2}var n,i,o={ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40},a="?v=1474315200000",s=void 0,r=void 0,l=void 0,c=void 0,d=document.documentElement.lang||"en",u=!1,f=!1,p={},h=function(){},g=/firefox/i.test(navigator.userAgent),m=!1,_={step:0,el:$("#panorama"),surface:void 0,container:$("#panorama .container"),surface_position:0,container_position:0,origin:0,panels:{names:["p1","p2","p3","p4","p5"],w:[],elem:[],bg_elem:[],path:"../assets/images/panels/",count:5,current:3,svg:[],bg_svg:[],init_w:[2218,1786,2968,2795,2476]},offset:{left:0,right:0},story_width:0,width:0,left_width:0,right_width:0,audio:{ext:/opera/i.test(navigator.userAgent)||g?"ogg":"mp3",path:"../assets/sounds/",elem:[],play_range:[[0,6.8],[6.8,9.9],[9.9,13.2],[13.2,18.1],[18.1,24.9],[24.9,32.4],[32.4,35.8],[35.8,45.8],[45.8,51.4],[51.4,57],[57,62.3],[62.3,67.4],[67.4,77.2],[77.2,81.5],[81.5,93.5],[93.5,100]],count:16,current:-1,muted:!1,soft_muted:!1,toggle:$(".sound-toggle"),default_volume:.6,fade_duration:500,can_play:!0,ready:void 0,next:-1,timeout_id:void 0,init:function(){var t=this;t.elem.forEach(function(t){"undefined"!=typeof t&&t.readyState>0&&(t.play(),t.pause(),t.currentTime=0)}),t.ready=!0,t.play(t.current)},volume:function(t){t>=0&&1>=t&&this.elem.forEach(function(e){e.volume=t})},play:function(t){var e=this;return"undefined"==typeof t&&(t=e.current),t>=0&&t<e.count?(e.next=t,e.ready?void(e.can_play&&(t!==e.current?e.stop(e.current,!0):e.actual_play())):void(e.current=t)):void 0},actual_play:function(){var t,e=this,n=e.elem[e.next];"undefined"!=typeof n&&n.readyState>0&&n.paused&&(t=e.muted||e.soft_muted,c&&t||(n.volume=e.default_volume,n.muted=t,n.play()),e.current=e.next)},stop:function(t,e){var n,i=this,o=!1,a="undefined"!=typeof t;if((a||!(t>=0&&t<i.count))&&(t=i.current),-1!==t&&(i.can_play=!1,n=i.elem[t],"undefined"!=typeof n&&n.readyState>0))if(o=!0,a&&!c){var s,r=i.default_volume/10,l=i.fade_duration/10;20>l&&(l=20),s=setInterval(function(){var t=n.volume-r;0>=t?(clearInterval(s),n.muted=0,n.pause(),e===!0&&i.actual_play.call(i),i.can_play=!0):n.volume=t},l)}else n.muted=0,n.pause(),e===!0&&i.actual_play.call(i),i.can_play=!0;o||(i.can_play=!0,e===!0&&i.actual_play.call(i))},toggle_mute:function(t){this.current>=1&&this.current<=this.count&&(c?t?this.elem[this.current].pause():this.elem[this.current].play():this.elem[this.current].muted=t)},mute:function(){this.muted=!0,this.toggle_mute(!0),this.toggle.addClass("muted")},unmute:function(){this.muted=!1,this.toggle_mute(!1),this.toggle.removeClass("muted")},softMute:function(){this.soft_muted=!0,this.toggle_mute(!0)},softUnMute:function(){this.soft_muted=!1,this.muted||this.toggle_mute(!1)},muteToggle:function(){this.muted?this.unmute():this.mute()},bind:function(){var t=this;t.toggle.click(function(){t.muteToggle()})}},position:{analyze:function(t,e){"boolean"!=typeof e&&(e=!0);var n,i=-1*((t+_.left_width)%_.story_width);0>i&&(i=_.story_width+i),i+=_.origin,n=100*i/_.story_width,_.audio.play_range.forEach(function(t,e){return n>=t[0]&&n<t[1]?void _.audio.play(e):void 0}),e&&x.sync()},flip:function(t){var e;t<=-1*_.offset.right?(e=-1*_.offset.left-(-1*t-_.offset.right),_.container_position=e,_.container.css(transformX(e))):t>=n-_.offset.left&&(e=-1*(_.offset.right-n-(t-(n-_.offset.left))),_.container_position=e,_.container.css(transformX(e)))}},animator:{finished:!1,faders:void 0,anims:void 0,bind:function(){var t=this;t.faders=$(".fpanel svg"),t.anims=$(".layer-colored"),t.anims.hover(function(){t.stop()},debounce(function(){t.start()},100)),t.anims.filter("[data-story]").click(function(){y.open(+$(this).attr("data-story"))})},play:function(){if(!this.finished){var t=this;t.faders.velocity("js.fade",{delay:900,complete:function(){t.play()}})}},start:function(){this.finished=!1,this.faders.length&&this.faders.css("opacity",.1),this.anims.css("opacity",1),this.play()},stop:function(){this.finished=!0,this.faders.velocity("stop",!0).css("opacity",1),this.anims.css("opacity",.1)}},scroll_by_pos:function(t){var e=this,i=e.container_position;e.container_position=t,e.container.velocity({translateX:[t,i]},{duration:300,easing:"linear",complete:function(){(t<=-1*e.offset.right||t>=n-e.offset.left)&&e.position.flip(t)}}),e.position.analyze(t)},scroll_by_pos_direct:function(t){{var e=this;e.container_position}e.container_position=t,e.container.css(transformX(t)),(t<=-1*e.offset.right||t>=n-e.offset.left)&&e.position.flip(t),e.position.analyze(t,!1)},scroll:function(t){var e=this;e.scroll_by_pos(e.container_position+-1*t*e.step)},bind:function(t){var e=this;if(t){e.audio.bind();var i=debounce(function(){C.hide(),v.hide(),e.scroll(-1)},100),a=debounce(function(){C.hide(),v.hide(),e.scroll(1)},100);$(document).keydown(function(t){t||(t=window.event);var e=t.keyCode||t.which;e==o.LEFT&&(u?y.prev():f?h():i()),e==o.RIGHT&&(u?y.next():f?h():a()),e===o.ESC&&(Object.keys(p).forEach(function(t){"function"==typeof p[t]&&p[t]()}),C.hide())}),addWheelListener(document,function(t){if(!f&&t.deltaY!==-0&&0!==t.deltaY){if(l&&Math.abs(t.deltaY)<10)return;t.deltaY<=-0?i():a()}})}e.animator.bind(t);var s=!0,r=e.el.find((t?"":".ghost ")+".dpanel");g&&r.on("mouseleave",function(){s=!0}),r.draggable({axis:"x",start:function(n){s=!1,e.surface=$(n.target),t&&!C.hidden&&C.hide()},drag:function(t,i){if(g&&s)return!1;var o=e.container_position+(i.position.left-e.surface_position);e.surface_position=i.position.left,o<=-1*e.offset.right||o>=n-e.offset.left?e.position.flip(o):(e.container_position=o,e.container.css(transformX(o))),e.position.analyze(o)},stop:function(){e.surface.css("left",0),e.surface_position=0,s=!0}})}},y={el:$("#story_popup"),content:$("#story_popup .content"),share:$(".share-story .addthis_sharing_toolbox"),current:5,count:10,meta:{},by_url:!1,max_width:992,close:function(){u=!1,f=!1,T.write();var t=this;t.toggle_youtube(t.current,!1),t.el.find(".window").velocity({opacity:0},{duration:500,complete:function(){t.el.attr("data-current",""),t.el.find(".content .story.active").removeClass("active")}}),_.audio.softUnMute(),t.on_animation(),delete p.story_to_close},before_open:function(){u=!0,f=!0;var t=this;_.audio.softMute(),t.off_animation(),$(".qtip:visible").qtip("hide"),t.update_height(t.content.find(".story.active")),p.story_to_close=function(){t.close()}},toggle_youtube:function(t,e){"undefined"==typeof e&&(e=!1);var n=$("#story_popup .content .story[data-id='"+t+"']"),i=n.attr("data-yid"),o=void 0;"undefined"!=typeof i&&youtubePlayers.hasOwnProperty(i)&&(o=youtubePlayers[i],o&&(s&&e&&"function"==typeof o.playVideo?o.playVideo():e||"function"!=typeof o.pauseVideo||o.pauseVideo()))},open:function(t,e){var n=this;T.write(n.name_by_id(t)),n.el.attr("data-current",t),n.el.find(".content .story.active").removeClass("active"),n.el.find(".content .story[data-id='"+t+"']").addClass("active"),n.before_open(t),n.el.find(".window").velocity({opacity:1},{duration:1e3,easing:"easeInCirc",complete:function(){n.toggle_youtube(t,!0),"function"==typeof e&&e()}}),this.current=t},next:function(t){"boolean"!=typeof t&&(t=!1);var e=this,n=e.current,i=n+1>e.count?1:n+1,o=e.el.find("[data-id='"+n+"']"),a=e.el.find("[data-id='"+i+"']").addClass("second");e.toggle_youtube(n,!1),e.toggle_youtube(i,!0),e.go_to(i),t||T.write(this.name_by_id(i)),e.update_height(a),e.content.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e.content.removeClass("scroll-left animated"),a.addClass("active").removeClass("second"),o.removeClass("active")}).addClass("scroll-left animated"),e.current=i},prev:function(t){"boolean"!=typeof t&&(t=!1);var e=this,n=e.current,i=n-1>0?n-1:e.count,o=e.el.find("[data-id='"+n+"']").addClass("second"),a=e.el.find("[data-id='"+i+"']").addClass("first");e.toggle_youtube(n,!1),e.toggle_youtube(i,!0),e.go_to(i),t||T.write(this.name_by_id(i)),e.update_height(a),e.content.addClass("scroll-right-origin").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e.content.removeClass("scroll-right-origin scroll-right animated"),a.addClass("active").removeClass("first"),o.removeClass("active second")}).addClass("scroll-right animated"),e.current=i},bind:function(t){var e=this;if(t&&(e.el.find(".prev-toggle").click(function(){e.prev()}),e.el.find(".next-toggle").click(function(){e.next()}),e.el.find(".close, .bg").click(function(){e.close()}),!s)){var i,o;e.el.find(".story .scroll-box").draggable({start:function(t,e){i=t.clientX,o=e.position.top},drag:function(t,e){var n;e.position.left=0,n=o-e.position.top,o=e.position.top,e.position.top=0,$(t.target).scrollTop(n+$(t.target).scrollTop())},stop:function(t){Math.abs(t.clientX-i)>n/2&&(i>t.clientX?e.next():e.prev())}})}},go_to:function(t){var e=$("#story"+t),i=(+e.closest(".panel").attr("data-panel"),_.container.get(0).getBoundingClientRect()),o=e.get(0).getBoundingClientRect();_.scroll_by_pos(i.left-o.left+n/2-o.width/2)},go_to_prev:function(){var t=this,e=t.current,n=e-1>0?e-1:t.count;t.go_to(n),t.current=n},go_to_next:function(){var t=this,e=t.current,n=e+1>t.count?1:e+1;t.go_to(n),t.current=n},go_to_and_open_current:function(){var t=this.current,e=$("#story"+t),i=(+e.closest(".panel").attr("data-panel"),_.container.get(0).getBoundingClientRect()),o=e.get(0).getBoundingClientRect();_.scroll_by_pos(i.left-o.left+n/2-o.width/2),y.by_url?(C.hidden=!0,C.el.hide(),y.open(t,function(){k.inc()}),y.by_url=!1):k.inc(),y.on_animation()},by_name:function(t){var e;js.story_titles.forEach(function(n,i){(n[0]===t||n[1]===t||n[2]===t)&&(e=i+1)}),"undefined"!=typeof e&&(this.go_to(e),this.open(e))},current_by_name:function(t){var e;js.story_titles.forEach(function(n,i){(n[0]===t||n[1]===t||n[2]===t)&&(e=i+1)}),"undefined"!=typeof e&&(this.current=e)},name_by_id:function(t){return js.story_titles[t-1][["en","ka","ru"].indexOf(d)]},off_animation:function(){_.animator.stop()},on_animation:function(){_.animator.start()},update_height:function(t){var e,n=this,i=n.el.find(".window").height(),o=t.find(".scroll-box iframe"),a=n.el.find(".content").width(),s=t.find("> .title").outerHeight();e=i-s-(r?0:20);for(var l=e/9*16,c=a>n.max_width?n.max_width:a;l>c;)--e,l=e/9*16;o.css({width:l+"px",height:e+"px"}),r&&(e=i-s,t.find(".scroll-box").css({height:e+"px"}))}},v={template:$(".tooltip-template").html(),text_by_story:function(t,e){var n,i,o=t;return"gear"===e&&(t="g"+t),y.meta.hasOwnProperty(t)||("story"===e?(n=y.el.find(".story[data-id='"+t+"']"),y.meta[t]={title:n.find(".title").text(),quote:n.find(".quote").text()}):(n=$(".gears [data-gear='"+o+"']"),y.meta[t]={title:n.attr("data-title"),quote:n.attr("data-quote")})),i=y.meta[t],this.template.replace("{{title}}",i.title).replace("{{quote}}",i.quote)},bind:function(t){$((t?"":".ghost")+".fpanel .layer-colored"+(r?"[data-gear]":"")).qtip({content:{text:function(){var t=$(this).attr("data-story")?"story":"gear";return v.text_by_story(+$(this).attr("data-"+t),t)},title:!1},position:{target:"mouse",viewport:$(window),my:"bottom left",at:"top right",adjust:{x:30,y:-40,method:"flipinvert flipinvert"}},style:{tip:{corner:!0,width:10,height:10,border:!0}}})},hide:function(){$(".qtip:visible").qtip("hide")}},b={el:$("#popup"),content:$("#popup .content"),is_behind:!1,close:function(){var t=this;f=!1,t.el.attr("data-type",""),t.toggle_youtube(!1),y.on_animation(),_.audio.softUnMute(),delete p.popup_to_close},open:function(t){var e=this;f=!0,e.el.attr("data-type",t),e.is_behind="behind"===t,e.is_behind&&e.update_height(),y.off_animation(),_.audio.softMute(),e.is_behind&&e.toggle_youtube(!0),p.popup_to_close=function(){e.close()}},bind:function(){var t=this;t.el.find(".close, .bg").on("click",function(){t.close()}),t.el.find(".about .to-character").click(function(t){b.close(),y.by_name(y.name_by_id(+$(this).attr("data-id"))),t.preventDefault()})},toggle_youtube:function(t){var e=this;if(e.is_behind){"undefined"==typeof t&&(t=!1);var n=$("#popup .behind .youtube"),i=n.attr("data-yid"),o=void 0;"undefined"!=typeof i&&youtubePlayers.hasOwnProperty(i)&&(o=youtubePlayers[i],o&&(t&&"function"==typeof o.playVideo?o.playVideo():t||"function"!=typeof o.pauseVideo||(o.pauseVideo(),e.is_behind=!1)))}},update_height:function(){{var t,e=this,n=e.content.height(),i=e.content.find("iframe"),o=e.content.width();e.content.find(".caption").outerHeight()}e.content.scrollTop(0),t=n-61-(r?0:20);for(var a=t/9*16,s=o>e.max_width?e.max_width:o;a>s;)--t,a=t/9*16;i.css({width:a+"px",height:t+"px"})}},w={nv:$(".nav"),el:$(".nav-menu"),bind:function(){var t=this;$(document).on("click",".nav-prev",function(){y.go_to_prev()}),$(document).on("click",".nav-next",function(){y.go_to_next()}),$(document).on("click",".nav-menu-toggle",function(){var e=t.el.attr("data-menu"),n="main"===e||"sub"===e;t.el.find(".nav-menu-container > li.active").removeClass("active"),t.el.attr("data-menu",n?"":"main"),$(this).toggleClass("active",!n)}),$(document).on("click",".nav-sub-menu-toggle",function(){var e=t.el.attr("data-menu"),n=$(this),i=n.parent(),o=i.hasClass("active");t.el.find(".nav-menu-container > li.active").removeClass("active"),i.toggleClass("active",!o),t.el.attr("data-menu","main"===e?"sub":"main")}),$(".nav-sub-menu-back").on("click",function(){t.el.attr("data-menu","main"),$(this).parent().parent().parent().removeClass("active")}),$("a[data-popup-target]").on("click",function(){b.open($(this).attr("data-popup-target"))})}},x={el:$(".minimap"),img:void 0,overlay:void 0,light:void 0,light_w:0,lights:void 0,capes:void 0,cape_w:0,img_w:0,pos:0,init:function(){var t=this;t.img=t.el.find("svg"),t.img_w=t.img.width(),t.overlay=t.el.find(".overlay"),t.light_w=Math.ceil(n/_.story_width*t.img_w),t.light_w%2&&++t.light_w,t.cape_w=t.img_w-t.light_w,t.light=t.overlay.find(".light_main"),t.lights=t.overlay.find(".light").width(t.light_w),t.capes=t.overlay.find(".cape").width(t.img_w-t.light_w),t.pos=-1*(2*t.cape_w+t.light_w),t.overlay.css(transformX(t.pos))},bind:function(){var t,e,n=this;n.init(),e=$(n.img),e.find("image.to-character").click(function(){y.go_to(+$(this).attr("data-id"))});var i=!0;g&&n.lights.on("mouseleave",function(){i=!0}),n.lights.draggable({axis:"x",start:function(e){i=!1,t=e.clientX},drag:function(e,o){if(g&&i)return!1;var a,s=e.clientX-t;n.pos+=s,-1*n.pos>2*n.cape_w+2*n.light_w?n.pos+=n.cape_w+n.light_w:-1*n.pos<n.cape_w&&(n.pos-=n.cape_w+n.light_w),a=-1*n.pos-2*n.cape_w-n.light_w,a>0&&(a=n.img_w-a),n.overlay.css(transformX(n.pos)),_.scroll_by_pos_direct(-1*(Math.abs(a)/n.img_w*_.story_width+_.offset.left)),t=e.clientX,o.position.left=0},stop:function(){i=!0}})},sync:function(){var t,e=this;t=-1*_.container_position-_.offset.left,e.pos=-1*(2*e.cape_w+e.light_w-t/_.story_width*e.img_w),e.overlay.css(transformX(e.pos))}},T={permit:["story"],trigger:{story:function(t){y.by_url=!0,y.current_by_name(t)}},parse:function(){var t,e,n,i=window.location.search.substring(1),o=i.split("&");for(t=0;t<o.length;t++)n=o[t].split("="),2==n.length&&-1!==this.permit.indexOf(n[0])&&(e=isNumber(n[1])?+n[1]:""!=n[1]?n[1]:void 0,"undefined"!=typeof e&&(T[n[0]]=e,this.trigger.hasOwnProperty(n[0])&&this.trigger[n[0]](e)))},write:function(t){var e=window.location.pathname+("undefined"!=typeof t?"?story="+t:"");window.history.pushState({story:t},null,e),y.share.attr("data-url",e)}},k={el:$("#loader"),image:$("#loader_image"),progress_label:$("#loader_progress span"),path:void 0,length:2133,progress:0,completed:!1,fade_duration:0,fade_easing:"easeInOutCirc",before_close_duration:0,aborted:!1,animate:!0,animate_duration:5e3,current_tick_index:0,scaler:void 0,stable_progress:0,inc:function(){var t,e=this;e.completed||(t=Math.round(e.scaler(++e.current_tick_index)),t=e.stable_progress+5*(isNaN(t)?1:t),t>e.progress&&(e.progress=t,e.progress_label.text(e.progress)),e.progress>=100&&e.complete())},retick:function(t,e){var n=this;n.stable_progress=n.progress,n.scaler=(new Scale).domain(1,e).range(1,t),n.current_tick_index=0},start_animation:function(){var t=this;return loaderReady?(t.path||(t.path=t.image.get(0).contentDocument.getElementsByTagName("path")[0],$(t.path).css("stroke-dasharray",t.length+"px"),t.length=t.path.getTotalLength()),void $(t.path).velocity({"stroke-dashoffset":[-1*t.length,0]},{duration:t.animate_duration,complete:function(){t.animate&&t.start_animation()}})):void setTimeout(function(){t.start_animation()},100)},complete:function(){var t=this;setTimeout(function(){t.animate=!1,t.el.find(".loader-box").hide(),t.el.fadeOut({duration:t.fade_duration,easing:t.fade_easing,complete:function(){t.completed=!0,t.progress=0}})},t.before_close_duration)},abort:function(){this.aborted=!0},abort_complete:function(){var t=this;t.aborted=!1,t.completed=!0,t.progress=0},restart:function(){var t=this;$(t.path).css("stroke-dasharray",t.length+"px"),t.progress=0,t.completed=!1,t.animate=!0,k.start_animation(),t.el.show(),t.el.find(".loader-box").show()}},C={el:$("#helper"),hidden:!1,bind:function(){var t=this;r&&$(document).one("touchstart.waiting_gesture",t.interact.bind(t))},interact:function(){var t=this;r&&_.audio.init(),t.el.fadeOut(800)},hide:function(t){!this.hidden&&s&&(this.el.stop(),"undefined"==typeof t?this.el.fadeOut(800):this.el.delay(t).fadeOut(1e3))}},E={first_time:!0,bind:function(){return k.aborted?void k.abort_complete():(k.retick(1,1),_.bind(E.first_time),v.bind(E.first_time),y.bind(E.first_time),E.first_time&&(P.bind(),w.bind(),x.bind(),b.bind(),C.bind(),E.first_time=!1),void y.go_to_and_open_current())},callback:function(t){if(k.aborted)return void k.abort_complete();e(),t&&f&&(u?y.update_height(y.content.find(".story.active")):b.update_height());var o=i-(n>992?120:60);_.el.find(".panel").css("height",o);var a,s,r=0,l=0,c=0,d=0,p=_.panels.svg,h=_.panels.bg_svg;_.container.find(".panel.ghost").remove(),_.panels.w=[],_.width=0,_.panels.elem.forEach(function(t,e){a=Math.floor(o*_.panels.init_w[e]/1e3),_.el.find(".panel[data-panel='"+(e+1)+"']").css("width",a),_.panels.w.push(a),_.width+=a}),_.story_width=_.width;for(var g="<div class='panel ghost' data-panel='%data-panel'><div class='bpanel'></div><div class='dpanel noselect'></div><div class='fpanel noselect'></div></div>";n>r;)++c,r+=_.panels.w[l],l=++l%_.panels.count;for(r=0,l=_.panels.count-1;n>r;)++c,r+=_.panels.w[l],0===--l&&(l=_.panels.count-1);for(c*=2,k.retick(t?19:5,0===c?1:c),r=0,l=0;n>r;)s=$(g.replace("%data-panel","r"+(l+1))).appendTo(_.container),s.css({height:o,width:_.panels.w[l]}),s.find(".bpanel").html(h[l]),k.inc(),++d===c&&setTimeout(E.bind,100),s.find(".fpanel").html(p[l].replace(/id\=\"story/g,'id="story_r_')),k.inc(),++d===c&&setTimeout(E.bind,100),r+=_.panels.w[l],l=++l%_.panels.count;for(_.right_width=r,_.width+=r,r=0,l=_.panels.count-1;n>r;)s=$(g.replace("%data-panel","l"+(l+1))).prependTo(_.container),s.css({height:o,width:_.panels.w[l]}),s.find(".bpanel").html(h[l]),k.inc(),++d===c&&setTimeout(E.bind,100),s.find(".fpanel").html(p[l].replace(/id\=\"story/g,'id="story_l_')),k.inc(),++d===c&&setTimeout(E.bind,100),r+=_.panels.w[l],0===--l&&(l=_.panels.count-1);_.left_width=r,_.width+=r,_.offset.right=_.width-_.right_width,_.offset.left=_.left_width,0===c&&(k.inc(),setTimeout(E.bind,100))},effects:function(){$.Velocity.RegisterEffect("js.fade",{defaultDuration:6e3,easing:"easeInOutCubic",calls:[[{opacity:1},.6],[{opacity:.1},.4]],reset:{opacity:.1}}),setTimeout(E.callback,100)},youtube:function(){k.retick(1,1);var t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e),window.onYouTubeIframeAPIReady=function(){y.el.find(".story .youtube[data-yid]").each(function(t){{var e=this.id,n=this.dataset.yid;$(t).parent().find(".r")}youtubePlayers[n]=new YT.Player(e,{videoId:n,width:"100%",playerVars:{showinfo:0,loop:1,autoplay:0,rel:0,cc_load_policy:1,hl:d},events:{onStateChange:function(t){if(!r){var e=t.target.getVideoData(),n=y.el.find(".story .youtube[data-yid='"+e.video_id+"']").parent().find(".r"),i=n.hasClass("played");t.data===YT.PlayerState.PLAYING?(i||n.addClass("played"),n.delay(7e3).fadeOut(i?400:1e3)):(t.data===YT.PlayerState.PAUSED||t.data===YT.PlayerState.ENDED)&&n.fadeIn(400)}}}})}),b.el.find(".youtube[data-yid]").each(function(){var t=this.id,e=this.dataset.yid;youtubePlayers[e]=new YT.Player(t,{videoId:e,width:"100%",playerVars:{showinfo:0,loop:1,autoplay:0,rel:0,cc_load_policy:1,hl:d}})}),k.inc(),setTimeout(E.effects,100)}},audio:function(){var t=0,e=_.audio.count,n=_.audio.ext,i=_.audio.path;k.retick(1,16);for(var o=1;e>=o;++o)_.audio.elem.push($("<audio>",{preload:"auto",loop:!0,muted:!0,canplay:function(n){k.inc(),++t===e&&setTimeout(E.youtube,100),$(n.target).off("canplay")},error:function(t){console.log(this,t,"error in load audio for one of the file")},src:i+o+"."+n+a}).get(0))},panels_process:function(){var t,e,n,i="undefined"!=typeof window.XMLSerializer?new XMLSerializer:void 0;_.panels.elem.forEach(function(o,a){t=o.get(0).contentDocument.documentElement,e=_.panels.bg_elem[a].get(0).contentDocument.documentElement,n=t.hasOwnProperty("outerHTML")&&"undefined"!=typeof i,_.panels.svg.push(n?t.outerHTML:i.serializeToString(t)),o.replaceWith(_.panels.svg[a]),_.panels.bg_svg.push(n?e.outerHTML:i.serializeToString(e)),_.panels.bg_elem[a].replaceWith(_.panels.bg_svg[a]),_.panels.elem[a]=_.container.find(".panel[data-panel='"+(a+1)+"'] .fpanel svg")}),setTimeout(E.audio,100)},panels:function(){var t,e,n,i=0,o=2*_.panels.count+1;k.retick(12,11),_.panels.names.forEach(function(n,s){t=$("<object type='image/svg+xml' data='"+(_.panels.path+"bg/"+n+".svg"+a)+"'>"),_.panels.bg_elem.push(t),t.one("load",function(){k.inc(),++i===o&&setTimeout(E.panels_process,100)}),_.container.find(".panel[data-panel='"+(s+1)+"'] .bpanel").append(t),e=$("<object type='image/svg+xml' data='"+(_.panels.path+"fg/"+n+".svg"+a)+"'>"),_.panels.elem.push(e),e.one("load",function(){k.inc(),++i===o&&setTimeout(E.panels_process,100)}),_.container.find(".panel[data-panel='"+(s+1)+"'] .fpanel").append(e)}),n=$("<object type='image/svg+xml' data='../assets/images/map_fg.svg"+a+"'>"),n.one("load",function(){$(".preload-minimap").removeClass("preload-minimap"),n.replaceWith(n.get(0).contentDocument.documentElement.outerHTML),k.inc(),++i===o&&setTimeout(E.panels_process,100)}),x.el.find(".fg").append(n)},partial:function(){k.restart(),this.callback(!0)},all:function(){s=device.desktop(),r=!s,c=device.ios(),l=isMacintosh(),_.audio.ready=s,$(window).resize(function(){t()}),k.start_animation(),this.panels()}},P={bind:function(){var t,e,n=this,i=["hidden","mozHidden","msHidden","webkitHidden"],o=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange"];i.forEach(function(n,i){return"undefined"!=typeof document[n]?(t=n,void(e=o[i])):void 0}),"undefined"==typeof document[t]?document[t]=document.hasFocus():$(document).on(e,function(){n.toggle(!document[t])})},toggle:function(t){t?_.audio.play():_.audio.stop()}};!function(){T.parse(),E.all()}()});