var youtubePlayers={},loaderReady=!1;$(document).ready(function(){function A(a){!a&&o||(w.completed?(y.partial(),o=!1):(a||w.abort(),o=!0,setTimeout(function(){A(!0)},100)))}function B(){a=$(window).width(),b=$(window).height(),p.step=a/5,p.origin=a/2}var a,b,c={ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40},d="?v=1474315200000",e=void 0,f=void 0,g=void 0,h=void 0,i=document.documentElement.lang||"en",j=!1,k=!1,l={},m=function(){},n=/firefox/i.test(navigator.userAgent),o=!1,p={step:0,el:$("#panorama"),surface:void 0,container:$("#panorama .container"),surface_position:0,container_position:0,origin:0,panels:{names:["p1","p2","p3","p4","p5"],w:[],elem:[],bg_elem:[],path:"../assets/images/panels/",count:5,current:3,svg:[],bg_svg:[],init_w:[2218,1786,2968,2795,2476]},offset:{left:0,right:0},story_width:0,width:0,left_width:0,right_width:0,audio:{ext:/opera/i.test(navigator.userAgent)||n?"ogg":"mp3",path:"../assets/sounds/",elem:[],play_range:[[0,6.8],[6.8,9.9],[9.9,13.2],[13.2,18.1],[18.1,24.9],[24.9,32.4],[32.4,35.8],[35.8,45.8],[45.8,51.4],[51.4,57],[57,62.3],[62.3,67.4],[67.4,77.2],[77.2,81.5],[81.5,93.5],[93.5,100]],count:16,current:-1,muted:!1,soft_muted:!1,toggle:$(".sound-toggle"),default_volume:.6,fade_duration:500,can_play:!0,ready:void 0,next:-1,timeout_id:void 0,init:function(){var a=this;a.elem.forEach(function(a,b){"undefined"!=typeof a&&a.readyState>0&&(a.play(),a.pause(),a.currentTime=0)}),a.ready=!0,a.play(a.current)},volume:function(a){a>=0&&a<=1&&this.elem.forEach(function(b){b.volume=a})},play:function(a){var b=this;if("undefined"==typeof a&&(a=b.current),a>=0&&a<b.count)return b.next=a,b.ready?void(b.can_play&&(a!==b.current?b.stop(b.current,!0):b.actual_play())):void(b.current=a)},actual_play:function(){var c,a=this,b=a.elem[a.next];"undefined"!=typeof b&&b.readyState>0&&b.paused&&(c=a.muted||a.soft_muted,h&&c||(b.volume=a.default_volume,b.muted=c,b.play()),a.current=a.next)},stop:function(a,b){var e,c=this,d=!1,f="undefined"!=typeof a;if(!f&&a>=0&&a<c.count||(a=c.current),a!==-1&&(c.can_play=!1,e=c.elem[a],"undefined"!=typeof e&&e.readyState>0))if(d=!0,f&&!h){var i,g=c.default_volume/10,j=c.fade_duration/10;j<20&&(j=20),i=setInterval(function(){var a=e.volume-g;a<=0?(clearInterval(i),e.muted=0,e.pause(),b===!0&&c.actual_play.call(c),c.can_play=!0):e.volume=a},j)}else e.muted=0,e.pause(),b===!0&&c.actual_play.call(c),c.can_play=!0;d||(c.can_play=!0,b===!0&&c.actual_play.call(c))},toggle_mute:function(a){this.current>=1&&this.current<=this.count&&(h?a?this.elem[this.current].pause():this.elem[this.current].play():this.elem[this.current].muted=a)},mute:function(){this.muted=!0,this.toggle_mute(!0),this.toggle.addClass("muted")},unmute:function(){this.muted=!1,this.toggle_mute(!1),this.toggle.removeClass("muted")},softMute:function(){this.soft_muted=!0,this.toggle_mute(!0)},softUnMute:function(){this.soft_muted=!1,this.muted||this.toggle_mute(!1)},muteToggle:function(){this.muted?this.unmute():this.mute()},bind:function(){var a=this;a.toggle.click(function(){a.muteToggle()})}},position:{analyze:function(a,b){"boolean"!=typeof b&&(b=!0);var d,c=-1*((a+p.left_width)%p.story_width);c<0&&(c=p.story_width+c),c+=p.origin,d=100*c/p.story_width,p.audio.play_range.forEach(function(a,b){if(d>=a[0]&&d<a[1])return void p.audio.play(b)}),b&&u.sync()},flip:function(b){var c;b<=-1*p.offset.right?(c=-1*p.offset.left-(-1*b-p.offset.right),p.container_position=c,p.container.css(transformX(c))):b>=a-p.offset.left&&(c=-1*(p.offset.right-a-(b-(a-p.offset.left))),p.container_position=c,p.container.css(transformX(c)))}},animator:{finished:!1,faders:void 0,anims:void 0,bind:function(a){var b=this;b.faders=$(".fpanel svg"),b.anims=$(".layer-colored"),b.anims.hover(function(){b.stop()},debounce(function(){b.start()},100)),b.anims.filter("[data-story]").click(function(){q.open(+$(this).attr("data-story"))})},play:function(){if(!this.finished){var a=this;a.faders.velocity("js.fade",{delay:900,complete:function(){a.play()}})}},start:function(){this.finished=!1,this.faders.length&&this.faders.css("opacity",.1),this.anims.css("opacity",1),this.play()},stop:function(){this.finished=!0,this.faders.velocity("stop",!0).css("opacity",1),this.anims.css("opacity",.1)}},scroll_by_pos:function(b){var c=this,d=c.container_position;c.container_position=b,c.container.velocity({translateX:[b,d]},{duration:300,easing:"linear",complete:function(){(b<=-1*c.offset.right||b>=a-c.offset.left)&&c.position.flip(b)}}),c.position.analyze(b)},scroll_by_pos_direct:function(b){var c=this;c.container_position;c.container_position=b,c.container.css(transformX(b)),(b<=-1*c.offset.right||b>=a-c.offset.left)&&c.position.flip(b),c.position.analyze(b,!1)},scroll:function(a){var b=this;b.scroll_by_pos(b.container_position+-1*a*b.step)},bind:function(b){var d=this;if(b){d.audio.bind();var e=debounce(function(){x.hide(),r.hide(),d.scroll(-1)},100),f=debounce(function(){x.hide(),r.hide(),d.scroll(1)},100);$(document).keydown(function(a){a||(a=window.event);var b=a.keyCode||a.which;b==c.LEFT&&(j?q.prev():k?m():e()),b==c.RIGHT&&(j?q.next():k?m():f()),b===c.ESC&&(Object.keys(l).forEach(function(a){"function"==typeof l[a]&&l[a]()}),x.hide())}),addWheelListener(document,function(a){if(!k&&a.deltaY!==-0&&0!==a.deltaY){if(g&&Math.abs(a.deltaY)<10)return;a.deltaY<=-0?e():f()}})}d.animator.bind(b);var h=!0,i=d.el.find((b?"":".ghost ")+".dpanel");n&&i.on("mouseleave",function(){h=!0}),i.draggable({axis:"x",start:function(a,c){h=!1,d.surface=$(a.target),b&&!x.hidden&&x.hide()},drag:function(b,c){if(n&&h)return!1;var e=d.container_position+(c.position.left-d.surface_position);d.surface_position=c.position.left,e<=-1*d.offset.right||e>=a-d.offset.left?d.position.flip(e):(d.container_position=e,d.container.css(transformX(e))),d.position.analyze(e)},stop:function(a,b){d.surface.css("left",0),d.surface_position=0,h=!0}})}},q={el:$("#story_popup"),content:$("#story_popup .content"),share:$(".share-story .addthis_sharing_toolbox"),current:5,count:10,meta:{},by_url:!1,max_width:992,close:function(){j=!1,k=!1,v.write();var a=this;a.toggle_youtube(a.current,!1),a.el.find(".window").velocity({opacity:0},{duration:500,complete:function(){a.el.attr("data-current",""),a.el.find(".content .story.active").removeClass("active")}}),p.audio.softUnMute(),a.on_animation(),delete l.story_to_close},before_open:function(a){j=!0,k=!0;var b=this;p.audio.softMute(),b.off_animation(),$(".qtip:visible").qtip("hide"),b.update_height(b.content.find(".story.active")),l.story_to_close=function(){b.close()}},toggle_youtube:function(a,b){"undefined"==typeof b&&(b=!1);var c=$("#story_popup .content .story[data-id='"+a+"']"),d=c.attr("data-yid"),f=void 0;"undefined"!=typeof d&&youtubePlayers.hasOwnProperty(d)&&(f=youtubePlayers[d],f&&(e&&b&&"function"==typeof f.playVideo?f.playVideo():b||"function"!=typeof f.pauseVideo||f.pauseVideo()))},open:function(a,b){var c=this;v.write(c.name_by_id(a)),c.el.attr("data-current",a),c.el.find(".content .story.active").removeClass("active"),c.el.find(".content .story[data-id='"+a+"']").addClass("active"),c.before_open(a),c.el.find(".window").velocity({opacity:1},{duration:1e3,easing:"easeInCirc",complete:function(){c.toggle_youtube(a,!0),"function"==typeof b&&b()}}),this.current=a},next:function(a){"boolean"!=typeof a&&(a=!1);var b=this,c=b.current,d=c+1>b.count?1:c+1,e=b.el.find("[data-id='"+c+"']"),f=b.el.find("[data-id='"+d+"']").addClass("second");b.toggle_youtube(c,!1),b.toggle_youtube(d,!0),b.go_to(d),a||v.write(this.name_by_id(d)),b.update_height(f),b.content.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(a){b.content.removeClass("scroll-left animated"),f.addClass("active").removeClass("second"),e.removeClass("active")}).addClass("scroll-left animated"),b.current=d},prev:function(a){"boolean"!=typeof a&&(a=!1);var b=this,c=b.current,d=c-1>0?c-1:b.count,e=b.el.find("[data-id='"+c+"']").addClass("second"),f=b.el.find("[data-id='"+d+"']").addClass("first");b.toggle_youtube(c,!1),b.toggle_youtube(d,!0),b.go_to(d),a||v.write(this.name_by_id(d)),b.update_height(f),b.content.addClass("scroll-right-origin").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(a){b.content.removeClass("scroll-right-origin scroll-right animated"),f.addClass("active").removeClass("first"),e.removeClass("active second")}).addClass("scroll-right animated"),b.current=d},bind:function(b){var c=this;if(b&&(c.el.find(".prev-toggle").click(function(){c.prev()}),c.el.find(".next-toggle").click(function(){c.next()}),c.el.find(".close, .bg").click(function(){c.close()}),!e)){var o,p;c.el.find(".story .scroll-box").draggable({start:function(a,b){o=a.clientX,p=b.position.top},drag:function(a,b){var c;b.position.left=0,c=p-b.position.top,p=b.position.top,b.position.top=0,$(a.target).scrollTop(c+$(a.target).scrollTop())},stop:function(b){Math.abs(b.clientX-o)>a/2&&(o>b.clientX?c.next():c.prev())}})}},go_to:function(b){var c=$("#story"+b),e=(+c.closest(".panel").attr("data-panel"),p.container.get(0).getBoundingClientRect()),f=c.get(0).getBoundingClientRect();p.scroll_by_pos(e.left-f.left+a/2-f.width/2)},go_to_prev:function(){var a=this,b=a.current,c=b-1>0?b-1:a.count;a.go_to(c),a.current=c},go_to_next:function(){var a=this,b=a.current,c=b+1>a.count?1:b+1;a.go_to(c),a.current=c},go_to_and_open_current:function(){var b=this.current,c=$("#story"+b),e=(+c.closest(".panel").attr("data-panel"),p.container.get(0).getBoundingClientRect()),f=c.get(0).getBoundingClientRect();p.scroll_by_pos(e.left-f.left+a/2-f.width/2),q.by_url?(x.hidden=!0,x.el.hide(),q.open(b,function(){w.inc()}),q.by_url=!1):w.inc(),q.on_animation()},by_name:function(a){var b;js.story_titles.forEach(function(c,d){c[0]!==a&&c[1]!==a&&c[2]!==a||(b=d+1)}),"undefined"!=typeof b&&(this.go_to(b),this.open(b))},current_by_name:function(a){var b;js.story_titles.forEach(function(c,d){c[0]!==a&&c[1]!==a&&c[2]!==a||(b=d+1)}),"undefined"!=typeof b&&(this.current=b)},name_by_id:function(a){return js.story_titles[a-1][["en","ka","ru"].indexOf(i)]},off_animation:function(){p.animator.stop()},on_animation:function(){p.animator.start()},update_height:function(a){var c,b=this,d=b.el.find(".window").height(),e=a.find(".scroll-box iframe"),g=b.el.find(".content").width(),h=a.find("> .title").outerHeight();c=d-h-(f?0:20);for(var i=c/9*16,j=g>b.max_width?b.max_width:g;i>j;)--c,i=c/9*16;e.css({width:i+"px",height:c+"px"}),f&&(c=d-h,a.find(".scroll-box").css({height:c+"px"}))}},r={template:$(".tooltip-template").html(),text_by_story:function(a,b){var c,d,e=a;return"gear"===b&&(a="g"+a),q.meta.hasOwnProperty(a)||("story"===b?(c=q.el.find(".story[data-id='"+a+"']"),q.meta[a]={title:c.find(".title").text(),quote:c.find(".quote").text()}):(c=$(".gears [data-gear='"+e+"']"),q.meta[a]={title:c.attr("data-title"),quote:c.attr("data-quote")})),d=q.meta[a],this.template.replace("{{title}}",d.title).replace("{{quote}}",d.quote)},bind:function(a){$((a?"":".ghost")+".fpanel .layer-colored"+(f?"[data-gear]":"")).qtip({content:{text:function(){var a=$(this).attr("data-story")?"story":"gear";return r.text_by_story(+$(this).attr("data-"+a),a)},title:!1},position:{target:"mouse",viewport:$(window),my:"bottom left",at:"top right",adjust:{x:30,y:-40,method:"flipinvert flipinvert"}},style:{tip:{corner:!0,width:10,height:10,border:!0}}})},hide:function(){$(".qtip:visible").qtip("hide")}},s={el:$("#popup"),content:$("#popup .content"),is_behind:!1,close:function(){var a=this;k=!1,a.el.attr("data-type",""),a.toggle_youtube(!1),q.on_animation(),p.audio.softUnMute(),delete l.popup_to_close},open:function(a){var b=this;k=!0,b.el.attr("data-type",a),b.is_behind="behind"===a,b.is_behind&&b.update_height(),q.off_animation(),p.audio.softMute(),b.is_behind&&b.toggle_youtube(!0),l.popup_to_close=function(){b.close()}},bind:function(){var a=this;a.el.find(".close, .bg").on("click",function(){a.close()}),a.el.find(".about .to-character").click(function(a){s.close(),q.by_name(q.name_by_id(+$(this).attr("data-id"))),a.preventDefault()})},toggle_youtube:function(a){var b=this;if(b.is_behind){"undefined"==typeof a&&(a=!1);var c=$("#popup .behind .youtube"),d=c.attr("data-yid"),e=void 0;"undefined"!=typeof d&&youtubePlayers.hasOwnProperty(d)&&(e=youtubePlayers[d],e&&(a&&"function"==typeof e.playVideo?e.playVideo():a||"function"!=typeof e.pauseVideo||(e.pauseVideo(),b.is_behind=!1)))}},update_height:function(){var b,a=this,c=a.content.height(),d=a.content.find("iframe"),e=a.content.width();a.content.find(".caption").outerHeight();a.content.scrollTop(0),b=c-61-(f?0:20);for(var h=b/9*16,i=e>a.max_width?a.max_width:e;h>i;)--b,h=b/9*16;d.css({width:h+"px",height:b+"px"})}},t={nv:$(".nav"),el:$(".nav-menu"),bind:function(){var a=this;$(document).on("click",".nav-prev",function(){q.go_to_prev()}),$(document).on("click",".nav-next",function(){q.go_to_next()}),$(document).on("click",".nav-menu-toggle",function(){var b=a.el.attr("data-menu"),c="main"===b||"sub"===b;a.el.find(".nav-menu-container > li.active").removeClass("active"),a.el.attr("data-menu",c?"":"main"),$(this).toggleClass("active",!c)}),$(document).on("click",".nav-sub-menu-toggle",function(){var b=a.el.attr("data-menu"),c=$(this),d=c.parent(),e=d.hasClass("active");a.el.find(".nav-menu-container > li.active").removeClass("active"),d.toggleClass("active",!e),a.el.attr("data-menu","main"===b?"sub":"main")}),$(".nav-sub-menu-back").on("click",function(){a.el.attr("data-menu","main"),$(this).parent().parent().parent().removeClass("active")}),$("a[data-popup-target]").on("click",function(){s.open($(this).attr("data-popup-target"))})}},u={el:$(".minimap"),img:void 0,overlay:void 0,light:void 0,light_w:0,lights:void 0,capes:void 0,cape_w:0,img_w:0,pos:0,init:function(){var b=this;b.img=b.el.find("svg"),b.img_w=b.img.width(),b.overlay=b.el.find(".overlay"),b.light_w=Math.ceil(a/p.story_width*b.img_w),b.light_w%2&&++b.light_w,b.cape_w=b.img_w-b.light_w,b.light=b.overlay.find(".light_main"),b.lights=b.overlay.find(".light").width(b.light_w),b.capes=b.overlay.find(".cape").width(b.img_w-b.light_w),b.pos=-1*(2*b.cape_w+b.light_w),b.overlay.css(transformX(b.pos))},bind:function(){var b,c,a=this;a.init(),c=$(a.img),c.find("image.to-character").click(function(){q.go_to(+$(this).attr("data-id"))});var d=!0;n&&a.lights.on("mouseleave",function(){d=!0}),a.lights.draggable({axis:"x",start:function(a,c){d=!1,b=a.clientX},drag:function(c,e){if(n&&d)return!1;var g,f=c.clientX-b;a.pos+=f,-1*a.pos>2*a.cape_w+2*a.light_w?a.pos+=a.cape_w+a.light_w:-1*a.pos<a.cape_w&&(a.pos-=a.cape_w+a.light_w),g=-1*a.pos-2*a.cape_w-a.light_w,g>0&&(g=a.img_w-g),a.overlay.css(transformX(a.pos)),p.scroll_by_pos_direct(-1*(Math.abs(g)/a.img_w*p.story_width+p.offset.left)),b=c.clientX,e.position.left=0},stop:function(a,b){d=!0}})},sync:function(){var b,a=this;b=-1*p.container_position-p.offset.left,a.pos=-1*(2*a.cape_w+a.light_w-b/p.story_width*a.img_w),a.overlay.css(transformX(a.pos))}},v={permit:["story"],trigger:{story:function(a){q.by_url=!0,q.current_by_name(a)}},parse:function(){var c,d,e,a=window.location.search.substring(1),b=a.split("&");for(c=0;c<b.length;c++)e=b[c].split("="),2==e.length&&this.permit.indexOf(e[0])!==-1&&(d=isNumber(e[1])?+e[1]:""!=e[1]?e[1]:void 0,"undefined"!=typeof d&&(v[e[0]]=d,this.trigger.hasOwnProperty(e[0])&&this.trigger[e[0]](d)))},write:function(a){var b=window.location.pathname+("undefined"!=typeof a?"?story="+a:"");window.history.pushState({story:a},null,b),q.share.attr("data-url",b)}},w={el:$("#loader"),image:$("#loader_image"),progress_label:$("#loader_progress span"),path:void 0,length:2133,progress:0,completed:!1,fade_duration:0,fade_easing:"easeInOutCirc",before_close_duration:0,aborted:!1,animate:!0,animate_duration:5e3,current_tick_index:0,scaler:void 0,stable_progress:0,inc:function(){var b,a=this;a.completed||(b=Math.round(a.scaler(++a.current_tick_index)),b=a.stable_progress+5*(isNaN(b)?1:b),b>a.progress&&(a.progress=b,a.progress_label.text(a.progress)),a.progress>=100&&a.complete())},retick:function(a,b){var c=this;c.stable_progress=c.progress,c.scaler=(new Scale).domain(1,b).range(1,a),c.current_tick_index=0},start_animation:function(){var a=this;return loaderReady?(a.path||(a.path=a.image.get(0).contentDocument.getElementsByTagName("path")[0],$(a.path).css("stroke-dasharray",a.length+"px"),a.length=a.path.getTotalLength()),void $(a.path).velocity({"stroke-dashoffset":[-1*a.length,0]},{duration:a.animate_duration,complete:function(){a.animate&&a.start_animation()}})):void setTimeout(function(){a.start_animation()},100)},complete:function(){var a=this;setTimeout(function(){a.animate=!1,a.el.find(".loader-box").hide(),a.el.fadeOut({duration:a.fade_duration,easing:a.fade_easing,complete:function(){a.completed=!0,a.progress=0}})},a.before_close_duration)},abort:function(){this.aborted=!0},abort_complete:function(){var a=this;a.aborted=!1,a.completed=!0,a.progress=0},restart:function(){var a=this;$(a.path).css("stroke-dasharray",a.length+"px"),a.progress=0,a.completed=!1,a.animate=!0,w.start_animation(),a.el.show(),a.el.find(".loader-box").show()}},x={el:$("#helper"),hidden:!1,bind:function(){var a=this;f&&$(document).one("touchstart.waiting_gesture",a.interact.bind(a))},interact:function(){var a=this;f&&p.audio.init(),a.el.fadeOut(800)},hide:function(a){!this.hidden&&e&&(this.el.stop(),"undefined"==typeof a?this.el.fadeOut(800):this.el.delay(a).fadeOut(1e3))}},y={first_time:!0,bind:function(){return w.aborted?void w.abort_complete():(w.retick(1,1),p.bind(y.first_time),r.bind(y.first_time),q.bind(y.first_time),y.first_time&&(z.bind(),t.bind(),u.bind(),s.bind(),x.bind(),y.first_time=!1),void q.go_to_and_open_current())},callback:function(c){if(w.aborted)return void w.abort_complete();B(),c&&k&&(j?q.update_height(q.content.find(".story.active")):s.update_height());var d=b-(a>992?120:60);p.el.find(".panel").css("height",d);var e,h,f=0,g=0,i=0,l=0,n=p.panels.svg,o=p.panels.bg_svg;p.container.find(".panel.ghost").remove(),p.panels.w=[],p.width=0,p.panels.elem.forEach(function(a,b){e=Math.floor(d*p.panels.init_w[b]/1e3),p.el.find(".panel[data-panel='"+(b+1)+"']").css("width",e),p.panels.w.push(e),p.width+=e}),p.story_width=p.width;for(var r="<div class='panel ghost' data-panel='%data-panel'><div class='bpanel'></div><div class='dpanel noselect'></div><div class='fpanel noselect'></div></div>";f<a;)++i,f+=p.panels.w[g],g=++g%p.panels.count;for(f=0,g=p.panels.count-1;f<a;)++i,f+=p.panels.w[g],0===--g&&(g=p.panels.count-1);for(i*=2,w.retick(c?19:5,0===i?1:i),f=0,g=0;f<a;)h=$(r.replace("%data-panel","r"+(g+1))).appendTo(p.container),h.css({height:d,width:p.panels.w[g]}),h.find(".bpanel").html(o[g]),w.inc(),++l===i&&setTimeout(y.bind,100),h.find(".fpanel").html(n[g].replace(/id\=\"story/g,'id="story_r_')),w.inc(),++l===i&&setTimeout(y.bind,100),f+=p.panels.w[g],g=++g%p.panels.count;for(p.right_width=f,p.width+=f,f=0,g=p.panels.count-1;f<a;)h=$(r.replace("%data-panel","l"+(g+1))).prependTo(p.container),h.css({height:d,width:p.panels.w[g]}),h.find(".bpanel").html(o[g]),w.inc(),++l===i&&setTimeout(y.bind,100),h.find(".fpanel").html(n[g].replace(/id\=\"story/g,'id="story_l_')),w.inc(),++l===i&&setTimeout(y.bind,100),f+=p.panels.w[g],0===--g&&(g=p.panels.count-1);p.left_width=f,p.width+=f,p.offset.right=p.width-p.right_width,p.offset.left=p.left_width,0===i&&(w.inc(),setTimeout(y.bind,100))},effects:function(){$.Velocity.RegisterEffect("js.fade",{defaultDuration:6e3,easing:"easeInOutCubic",calls:[[{opacity:1},.6],[{opacity:.1},.4]],reset:{opacity:.1}}),setTimeout(y.callback,100)},youtube:function(){w.retick(1,1);var a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b),window.onYouTubeIframeAPIReady=function(){q.el.find(".story .youtube[data-yid]").each(function(a,b){var c=this.id,d=this.dataset.yid;$(a).parent().find(".r");youtubePlayers[d]=new YT.Player(c,{videoId:d,width:"100%",playerVars:{showinfo:0,loop:1,autoplay:0,rel:0,cc_load_policy:1,hl:i},events:{onStateChange:function(a){if(!f){var b=a.target.getVideoData(),c=q.el.find(".story .youtube[data-yid='"+b.video_id+"']").parent().find(".r"),d=c.hasClass("played");a.data===YT.PlayerState.PLAYING?(d||c.addClass("played"),c.delay(7e3).fadeOut(d?400:1e3)):a.data!==YT.PlayerState.PAUSED&&a.data!==YT.PlayerState.ENDED||c.fadeIn(400)}}}})}),s.el.find(".youtube[data-yid]").each(function(a,b){var c=this.id,d=this.dataset.yid;youtubePlayers[d]=new YT.Player(c,{videoId:d,width:"100%",playerVars:{showinfo:0,loop:1,autoplay:0,rel:0,cc_load_policy:1,hl:i}})}),w.inc(),setTimeout(y.effects,100)}},audio:function(){var a=0,c=p.audio.count,e=p.audio.ext,f=p.audio.path;w.retick(1,16);for(var g=1;g<=c;++g)p.audio.elem.push($("<audio>",{preload:"auto",loop:!0,muted:!0,canplay:function(b){w.inc(),++a===c&&setTimeout(y.youtube,100),$(b.target).off("canplay")},error:function(a){console.log(this,a,"error in load audio for one of the file")},src:f+g+"."+e+d}).get(0))},panels_process:function(){var a,b,c,d="undefined"!=typeof window.XMLSerializer?new XMLSerializer:void 0;p.panels.elem.forEach(function(e,f){a=e.get(0).contentDocument.documentElement,b=p.panels.bg_elem[f].get(0).contentDocument.documentElement,c=a.hasOwnProperty("outerHTML")&&"undefined"!=typeof d,p.panels.svg.push(c?a.outerHTML:d.serializeToString(a)),e.replaceWith(p.panels.svg[f]),p.panels.bg_svg.push(c?b.outerHTML:d.serializeToString(b)),p.panels.bg_elem[f].replaceWith(p.panels.bg_svg[f]),p.panels.elem[f]=p.container.find(".panel[data-panel='"+(f+1)+"'] .fpanel svg")}),setTimeout(y.audio,100)},panels:function(){var b,c,e,a=0,f=2*p.panels.count+1;w.retick(12,11),p.panels.names.forEach(function(e,g){b=$("<object type='image/svg+xml' data='"+(p.panels.path+"bg/"+e+".svg"+d)+"'>"),p.panels.bg_elem.push(b),b.one("load",function(b){w.inc(),++a===f&&setTimeout(y.panels_process,100)}),p.container.find(".panel[data-panel='"+(g+1)+"'] .bpanel").append(b),c=$("<object type='image/svg+xml' data='"+(p.panels.path+"fg/"+e+".svg"+d)+"'>"),p.panels.elem.push(c),c.one("load",function(b){w.inc(),++a===f&&setTimeout(y.panels_process,100)}),p.container.find(".panel[data-panel='"+(g+1)+"'] .fpanel").append(c)}),e=$("<object type='image/svg+xml' data='../assets/images/map_fg.svg"+d+"'>"),e.one("load",function(b){$(".preload-minimap").removeClass("preload-minimap"),e.replaceWith(e.get(0).contentDocument.documentElement.outerHTML),w.inc(),++a===f&&setTimeout(y.panels_process,100)}),u.el.find(".fg").append(e)},partial:function(){w.restart(),this.callback(!0)},all:function(){e=device.desktop(),f=!e,h=device.ios(),g=isMacintosh(),p.audio.ready=e,$(window).resize(function(){A()}),w.start_animation(),this.panels()}},z={bind:function(){var b,c,a=this,d=["hidden","mozHidden","msHidden","webkitHidden"],e=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange"];d.forEach(function(a,d){if("undefined"!=typeof document[a])return b=a,void(c=e[d])}),"undefined"==typeof document[b]?document[b]=document.hasFocus():$(document).on(c,function(){a.toggle(!document[b])})},toggle:function(a){a?p.audio.play():p.audio.stop()}};!function(){I18n.init(function(){window.pn=p,I18n.remap(),v.parse(),y.all()})}()});
